# BEAT MASTER - Rhythm Game

디제이맥스 스타일의 리듬게임 에디터 & 플레이어

## 📁 파일 구성

- **rhythm-game-editor-auto.html** - ⭐⭐⭐⭐ AUTO 에디터 (완전 자동! BPM+Offset 자동 감지) **✨ NEW!**
- **rhythm-game-editor-final.html** - ⭐⭐⭐ FINAL 에디터 (BPM 그리드 기반, 가장 정확!)
- **rhythm-game-editor-pro-v2.html** - ⭐⭐ 프로 에디터 v2 (개선된 비트 감지)
- **rhythm-game-editor-pro.html** - ⭐ 프로 차트 에디터 (전문가용)
- **rhythm-game-editor.html** - 차트 에디터 (노트 생성/편집)
- **rhythm-game-player.html** - 게임 플레이어 (실제 플레이)
- **rhythm-game.html** - 올인원 버전 (자동 생성 + 플레이)
- **BEAT_DETECTION.md** - 고급 비트 감지 알고리즘 기술 문서
- **NOTE_GENERATION.md** - 노트 생성 로직 상세 설명
- **CHARTING_METHODOLOGY.md** - 리듬게임 노트 제작 방법론 (필독!)

## 🎮 게임 특징

### 레인 구성 (5개)
```
D    F    Space    J    K
└────┴───────┴────┴────┘
   왼손      가운데    오른손
```

### 판정 시스템
- **PERFECT**: ±50ms (100점)
- **GREAT**: ±100ms (70점)
- **GOOD**: ±150ms (40점)
- **MISS**: ±200ms (0점, 체력 -5)

### ✨ 플레이어 개선 사항 (v2024)
- ✅ **Offset 자동 로드**: 에디터에서 저장한 offset을 자동으로 적용
- ✅ **비트 그리드 표시**: 흰색 마디 선(4박) + 회색 박 선(매박)
- ✅ **정확한 타이밍**: 차트와 음악이 완벽하게 동기화
- ✅ **터치/마우스 지원**: 모바일 및 데스크톱 모두 지원

## 🚀 에디터 AUTO 사용법 (완전 자동! ✨ 가장 간편!)

### 🎯 왜 AUTO인가?

**완전 자동화 + 주파수 분석:**
- ✅ **BPM 자동 감지** → 수동 입력 불필요!
- ✅ **첫 비트 오프셋 자동 감지** → 타이밍 자동 보정!
- ✅ **Onset 감지** → 실제 음악의 비트 위치 찾기!
- ✅ **주파수 대역 분석** → 킥/스네어/하이햇 악기 구분!
- ✅ **레인 자동 매핑** → D,F=Kick / Space=멜로디 / J,K=Snare,Hat
- ✅ **비트 그리드 스냅** → 감지된 비트를 BPM 그리드에 정렬!
- ✅ **비트 그리드 시각화** → 박자 확인 쉬움!
- ✅ **난이도별 자동 생성** → 원클릭 완성!
- ✅ **수동 조정 가능** → BPM이나 Offset이 틀렸을 때 수정 가능

### 📋 사용 방법 (초간단! 3단계)

#### 1단계: 음원 로드
```
1. "📁 음원 로드" 버튼 클릭
2. 음원 파일 선택 (MP3, WAV, etc.)
3. 자동 분석 시작! (BPM + Offset 감지)
```

#### 2단계: 분석 완료 대기
```
로딩 화면:
→ "음원 로딩 중..." (오디오 디코딩)
→ "BPM 분석 중..." (템포 및 비트 감지)
→ "노트 생성 중..." (난이도별 패턴 생성)
→ "✨ 분석 완료!"
```

#### 3단계: 재생 및 확인
```
1. 자동 감지된 BPM 및 Offset 확인
2. "▶ 재생" 버튼으로 재생
3. 비트 그리드(흰색/회색 선)과 노트가 맞는지 확인
4. 필요시 BPM이나 Offset 수동 조정
```

### 🎚️ 난이도 선택

음원 로드 전에 난이도를 선택하세요:

**✨ Onset 기반 생성**: 실제 음악의 비트를 감지해서 노트를 배치합니다!

- **Easy**: 매우 강한 비트만 (초보자)
- **Normal**: 강한 비트 위주 (중급자)
- **Hard**: 대부분의 비트 (고급자) ← 기본값
- **Expert**: 모든 비트 (전문가)

난이도가 높을수록 더 약한 비트까지 감지합니다.
난이도 변경 후 "🔄 재생성" 버튼으로 다시 생성 가능!

### 🎨 비트 그리드 확인

재생 시 화면에 표시되는 선:

- **흰색 두꺼운 선**: 마디 (4박마다)
- **회색 얇은 선**: 박 (매박)

**노트가 선에 정확히 맞아야 합니다!**

### 🔧 타이밍이 안 맞을 때

#### BPM이 틀린 경우:
```
1. BPM 입력란 수정 (예: 135 → 140)
2. "적용" 버튼 클릭
3. 노트가 자동으로 재생성됨
```

#### Offset이 틀린 경우:
```
박자가 빠르면: Offset +0.05 (5ms씩 증가)
박자가 느리면: Offset -0.05 (5ms씩 감소)

Offset 입력 후 자동으로 노트 재생성됨
```

### 🎵 레인 매핑 (악기별 자동 배치)

**주파수 대역 분석으로 자동 배치:**

| 레인 | 키 | 악기 | 주파수 |
|------|-----|------|--------|
| 0, 1 | D, F | **Kick Drum** | 저음 (20-150Hz) |
| 2 | Space | **Melody** | 전체 |
| 3, 4 | J, K | **Snare, Hi-hat** | 중고음 (150Hz-20kHz) |

**작동 원리:**
1. 각 비트를 주파수 대역별로 분석
2. 가장 강한 대역 찾기
3. 해당 악기의 레인에 노트 배치

**결과:**
- 킥드럼 소리 → 왼쪽 레인 (D, F)
- 스네어/하이햇 → 오른쪽 레인 (J, K)
- 멜로디/기타 → 중앙 레인 (Space)

### 💡 팁

1. **분석이 완료되면 콘솔 확인**: 브라우저 개발자 도구(F12)에서 주파수 대역별 onset 개수 확인
2. **비트 그리드로 확인**: 재생하면서 노트가 흰색/회색 선에 맞는지 확인
3. **레인 위치 확인**: 킥드럼이 왼쪽에, 스네어가 오른쪽에 배치되는지 확인
4. **난이도 실험**: 같은 곡으로 여러 난이도 생성 가능
5. **수동 노트 추가**: 재생 중 D, F, Space, J, K 키로 노트 추가 가능

---

## 🎨 에디터 FINAL 사용법 (수동 BPM 설정)

### 🎯 왜 FINAL인가?

**이전 버전들의 문제:**
- ❌ 복잡한 onset detection → 실제 음악과 안 맞음
- ❌ 주파수 대역 분리 → EDM에서 작동 안 함
- ❌ 알고리즘이 불안정 → 예측 불가능한 결과

**FINAL의 해결책:**
- ✅ **BPM 그리드 기반** → 100% 정확한 타이밍
- ✅ **단순하고 명확** → 예측 가능한 결과
- ✅ **사용자 제어** → 원하는 대로 조정 가능

### 📋 사용 방법 (Return to Reality 1 예시)

#### 1단계: 기본 설정
```
1. 음원 로드
2. BPM: 135 입력 (중요!)
3. Offset: 0 (나중에 조정)
4. 제목: Return to Reality
```

#### 2단계: 생성 모드 선택

**Simple (권장 - 초보자)**
- 4박마다 1개 노트
- 가장 단순하고 플레이하기 쉬움
- Density 50% → 약 100-150개 노트

**Kick Only (중급)**
- 1박, 3박에 노트 (킥드럼 패턴)
- 왼쪽 레인 위주
- Density 50% → 약 200-250개 노트

**Kick + Snare (중급-고급)**
- 1,3박: 킥 (왼쪽)
- 2,4박: 스네어 (오른쪽)
- 전형적인 4/4 박자 패턴
- Density 50% → 약 250-300개 노트

**Full Drums (고급)**
- 1/8 박자마다 노트
- 매우 빠른 패턴
- Density 50% → 약 400-500개 노트

#### 3단계: 밀도 조절

```
Density 슬라이더: 10% ~ 100%

10-30%: 매우 적음 (Easy)
40-60%: 적당함 (Normal~Hard) ← 권장
70-90%: 많음 (Expert)
100%: 매우 많음 (Master)
```

#### 4단계: 생성 및 확인

1. **✨ 자동 생성** 클릭
2. 생성된 노트 개수 확인
3. **▶ 재생** 버튼으로 재생
4. **박자가 맞는지 확인!**

#### 5단계: 미세 조정

**박자가 약간 빠르면:**
→ Offset을 +0.05씩 증가

**박자가 약간 느리면:**
→ Offset을 -0.05씩 감소

**재생하며 수동으로 노트 추가:**
- D, F, Space, J, K 키로 추가
- Delete 키로 삭제

#### 6단계: 저장

**💾 저장** 클릭 → JSON 파일 다운로드

---

## 🎨 에디터 Pro v2 사용법

### ⚡ NEW! v2 주요 개선사항

**문제 해결:**
- ✅ 이전 버전의 "모든 노트가 킥으로만 나오는" 문제 해결
- ✅ "박자와 무관하게 생성되는" 문제 해결
- ✅ 실제 음악의 비트를 정확하게 감지

**새로운 기능:**

1. **개선된 비트 감지 알고리즘**
   - 간단하고 효과적인 RMS 에너지 기반 onset detection
   - BPM 그리드 자동 정렬
   - 중복 제거 및 최적화

2. **Sensitivity 컨트롤 (민감도 조절)**
   - 슬라이더로 1-10 단계 조절
   - 높을수록: 약한 비트도 감지 (더 많은 노트)
   - 낮을수록: 강한 비트만 감지 (적은 노트)

3. **Debug Mode (디버그 모드)**
   - 실시간 로그로 알고리즘 동작 확인
   - 비트 감지 과정 투명하게 공개
   - 문제 발생 시 분석 가능

4. **난이도별 자동 필터링**
   - Easy: 가장 강한 비트만 (입문자용)
   - Normal: 강한 비트 위주
   - Hard: 대부분의 비트 (권장)
   - Expert/Master: 모든 비트 (고수용)

5. **BPM 그리드 정렬**
   - BPM 설정 시 비트를 정확한 박자에 스냅
   - Offset으로 미세 조정 가능
   - 더 정확한 타이밍

#### v2 사용 방법

```
1. 음원 로드
   ↓
2. BPM 입력 (필수!)
   ↓
3. Sensitivity 조절 (기본값 5)
   ↓
4. Debug Mode 활성화 (권장)
   ↓
5. 🔍 비트 분석 실행
   ↓
6. 분석 결과 확인
   ↓
7. ✨ 스마트 생성
   ↓
8. 재생하며 확인 및 수정
   ↓
9. 💾 저장
```

#### 문제 해결 팁

**"노트가 너무 많아요"**
→ Sensitivity를 3-4로 낮추기

**"노트가 너무 적어요"**
→ Sensitivity를 7-8로 높이기

**"박자가 안 맞아요"**
→ BPM을 정확히 입력했는지 확인
→ Offset을 ±0.05 단위로 조정

**"분석 결과가 이상해요"**
→ Debug Mode 켜고 로그 확인
→ 다른 Sensitivity 값 시도

---

## 🎨 에디터 Pro 사용법 (v1)

### NEW! 프로 에디터 특징

`rhythm-game-editor-pro.html`은 CHARTING_METHODOLOGY.md의 가이드를 반영한 전문가용 에디터입니다.

#### 주요 기능

**1. Beat Snap Divisor (박자 분할)**
- 1/1, 1/2, 1/4, 1/8, 1/16, 1/3, 1/6, 1/12 지원
- 단축키: `Ctrl+1~8`로 빠른 전환
- 그리드 스냅 자동 정렬

**2. Note Type 시스템 (노트 타입)**
- Auto: 자동 색상 (레인별)
- Kick: 킥드럼 (빨강)
- Snare: 스네어 (청록)
- Hi-hat: 하이햇 (노랑)
- Melody: 멜로디 (민트)
- Vocal: 보컬 (핑크)

**3. 비주얼 그리드**
- 실시간 박자 분할선 표시
- 소절 번호 표시
- 판정선 기준 스크롤

**4. 실시간 통계**
- 노트 개수 / NPS (Notes Per Second)
- 현재 시간 / 박자 표시
- 밀도 그래프 (1초 단위 분석)
- 미니맵 (전체 차트 미리보기)

**5. 고급 단축키**
- `Ctrl+S`: 빠른 저장
- `Ctrl+Z`: 실행 취소
- `Ctrl+1~8`: Beat Snap 변경
- `Delete`: 마지막 노트 삭제

#### 프로 에디터 워크플로우

```
1. 음원 로드
   ↓
2. BPM, Offset 설정
   ↓
3. 🔍 비트 분석 실행
   ↓
4. ✨ 스마트 생성 (또는 수동 작성)
   ↓
5. Beat Snap Divisor 조정
   ↓
6. 재생하며 노트 추가/수정
   ↓
7. 노트 타입 지정 (선택사항)
   ↓
8. 밀도 그래프로 난이도 확인
   ↓
9. 💾 저장
```

---

## 🎨 에디터 사용법 (기본)

### 1. 파일 열기
`rhythm-game-editor.html`을 브라우저에서 실행

### 2. 음원 로드
- "음원 선택" 버튼 클릭
- MP3 파일 선택
- 자동으로 제목이 파일명으로 설정됨

### 3. BPM 설정
- BPM 입력란에 곡의 BPM 입력 (60-240)
- 모르면 기본값 120 사용

### 4. 노트 작성

#### 수동 작성
1. "재생" 버튼 클릭 (또는 Space 키)
2. 음악에 맞춰 키보드로 노트 추가:
   - **D** - 1번 레인
   - **F** - 2번 레인
   - **Space** - 3번 레인 (중앙)
   - **J** - 4번 레인
   - **K** - 5번 레인
3. 잘못된 노트는 **Delete** 키로 삭제 (마지막 노트부터)

#### 스마트 생성 (고급 비트 감지)
1. "🔍 비트 분석" 버튼으로 먼저 분석 품질 확인 (선택사항)
   - 전체 비트 수와 주파수 대역별 분포 확인
   - Kick(저음), Snare(중음), Hi-hat(고음) 개별 감지
2. "✨ 스마트 생성" 버튼 클릭
3. 실제 음악의 비트를 분석하여 자동 생성
   - 다중 주파수 대역 분석
   - 강도에 따른 노트 수 조정
   - 악기별 레인 매핑 (킥→왼쪽, 하이햇→오른쪽)
4. 수동으로 수정 가능

💡 **스마트 생성 vs 기존 방식**: 단순 BPM 간격이 아닌 실제 드럼 패턴을 감지하여 더 자연스러운 플레이 경험 제공

### 5. 차트 저장
- "차트 저장 (JSON)" 버튼 클릭
- `곡제목_chart.json` 파일 다운로드

### 에디터 단축키
| 키 | 기능 |
|----|------|
| Space | 재생/일시정지 |
| D, F, Space, J, K | 노트 추가 (재생 중) |
| Delete | 마지막 노트 삭제 |

## 🎯 플레이어 사용법

### ✨ 새로운 기능
- **자동 Offset 로드**: 에디터에서 설정한 타이밍 자동 적용
- **비트 그리드 표시**: 박자를 시각적으로 확인
  - 흰색 두꺼운 선: 마디 (4박)
  - 회색 얇은 선: 박 (매박)
- **완벽한 동기화**: 차트와 음악이 정확하게 맞음

### 1. 파일 열기
`rhythm-game-player.html`을 브라우저에서 실행

### 2. 파일 선택

#### 차트 파일 (JSON)
- "📄 차트 선택" 버튼 클릭
- 에디터에서 저장한 `.json` 파일 선택
- **offset이 자동으로 로드됩니다!**

#### 음원 파일 (MP3)
- "🎵 음원 선택" 버튼 클릭
- 에디터에서 사용한 **동일한** MP3 파일 선택

⚠️ **중요**: 차트와 음원이 일치해야 합니다!

### 3. 게임 시작
- 두 파일이 모두 로드되면 "게임 시작" 버튼 활성화
- 버튼 클릭으로 게임 시작
- 콘솔(F12)에서 차트 정보 확인 가능

### 4. 플레이

#### 키보드 조작
```
D    F    Space    J    K
```

#### 터치 조작 (모바일/태블릿)
- 화면 하단 터치 버튼 사용
- 각 레인에 대응하는 버튼 탭

#### 비트 그리드 확인
- 재생 중 흰색/회색 선이 스크롤됩니다
- **노트가 비트 그리드 선과 일치하는지 확인하세요!**
- 일치한다면 = 타이밍이 정확함
- 어긋난다면 = 차트를 다시 만들어야 함

### 5. 게임 종료
- 곡이 끝나면 자동으로 결과 화면
- 체력이 0이 되면 게임 오버
- **R 키** 또는 **화면 터치**로 재시작

## 📊 차트 파일 형식

### JSON 구조
```json
{
  "title": "곡 제목",
  "bpm": 120,
  "offset": 0.123,
  "difficulty": "Hard",
  "duration": 180.5,
  "lanes": 5,
  "notes": [
    {
      "time": 1.0,
      "lane": 0
    },
    {
      "time": 1.5,
      "lane": 2
    }
  ],
  "metadata": {
    "nps": "3.50",
    "noteCount": 630,
    "createdAt": "2025-10-28T...",
    "editor": "BEAT MASTER Auto"
  }
}
```

### 필드 설명
- **title**: 곡 제목
- **bpm**: BPM (Beats Per Minute)
- **offset**: 첫 비트 오프셋 (초) - 자동 감지됨
- **difficulty**: 난이도 (Easy/Normal/Hard/Expert)
- **duration**: 곡 길이 (초)
- **lanes**: 레인 개수 (항상 5)
- **notes**: 노트 배열
  - **time**: 노트가 판정선에 도달하는 시간 (초, offset 포함)
- **metadata**: 메타데이터
  - **nps**: Notes Per Second (초당 노트 수)
  - **noteCount**: 총 노트 개수
  - **editor**: 사용한 에디터
  - **lane**: 레인 인덱스 (0-4)
- **createdAt**: 생성 시각

## 🎨 UI/UX 특징

### 글래스모피즘 디자인
- 반투명 배경
- 블러 효과
- 네온 글로우

### 반응형 디자인
- 모든 화면 크기 지원
- 태블릿/모바일 최적화
- 터치 컨트롤 지원

### 시각 효과
- 파티클 배경 애니메이션
- 노트 히트 파티클 효과
- 판정 텍스트 애니메이션
- 레인별 색상 구분

## 🛠️ 기술 스택

- **PixiJS v8.12.0** - 2D WebGL 렌더링
- **Web Audio API** - 오디오 처리
- **Vanilla JavaScript** - 프레임워크 없음
- **HTML5 Canvas** - 그래픽 렌더링

## 📱 지원 환경

### 데스크톱
- Chrome, Edge, Firefox, Safari
- 키보드 조작

### 모바일/태블릿
- iOS Safari, Chrome
- Android Chrome
- 터치 조작

## 💡 팁

### 에디터 팁
1. **스마트 생성 활용**: 먼저 "🔍 비트 분석"으로 품질 확인 후 생성
2. **BPM 입력**: 정확한 BPM 입력 시 더 나은 분석 결과
3. **주파수 대역별 특성**:
   - Kick (저음): 킥드럼, 베이스드럼 → 왼쪽 레인
   - Snare (중음): 스네어, 클랩 → 중앙 레인
   - Hi-hat (고음): 하이햇, 심벌즈 → 오른쪽 레인
4. **리듬 연습**: 천천히 재생하며 노트 추가/삭제
5. **테스트**: 주기적으로 플레이어에서 테스트
6. **백업**: JSON 파일 여러 버전 저장
7. **기술 문서**: 알고리즘 상세 내용은 `BEAT_DETECTION.md` 참고

### 플레이 팁
1. **판정 라인 주시**: 노트가 흰색 선에 닿을 때 입력
2. **콤보 유지**: MISS 없이 연속 히트
3. **체력 관리**: 체력이 0이 되면 게임 오버
4. **정확도**: PERFECT 많이 맞추면 고득점

## 🐛 문제 해결

### 음원이 로드되지 않음
- MP3 파일 형식 확인
- 파일 크기 확인 (너무 크면 로딩 오래 걸림)
- 브라우저 콘솔 에러 확인

### 차트 파일 에러
- JSON 형식 확인
- notes 배열 존재 확인
- time, lane 값이 올바른지 확인

### 노트가 안 보임
- 브라우저 새로고침
- 캐시 삭제
- 다른 브라우저 시도

### 터치 버튼이 반응 없음
- 화면 새로고침
- 브라우저 설정에서 터치 이벤트 활성화 확인

## 📝 워크플로우 예시

### 1. 차트 제작
```
rhythm-game-editor.html
   ↓
1. MP3 로드
2. BPM 입력
3. 재생하며 노트 추가
4. JSON 저장
```

### 2. 플레이
```
rhythm-game-player.html
   ↓
1. JSON 로드
2. 같은 MP3 로드
3. 게임 시작
4. 플레이!
```

## 📄 라이선스

MIT License

## 🙏 크레딧

- PixiJS - 2D 렌더링 엔진
- Google Fonts - Orbitron, Noto Sans KR
- Web Audio API - 오디오 처리

---

**Made with ❤️ for rhythm game lovers**


![img.png](img.png)
![img_1.png](intro.png)
![img_1.png](thumbnail1.png)

![img_1.png](menu1.png)
![img_1.png](ListentoSong.png)
![img_1.png](singAlong1.png)

![img_1.png](singAlong2.png)